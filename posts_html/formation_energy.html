<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>A short story about formation energy</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">A short story about formation energy</h1>
</header>
<p>A few months ago I decided to learn more about the formation energy numbers that appear on the website <a href="http://equilibrator.weizmann.ac.il/">eQuilibrator</a>. I ended up learning a whole lot and thought I'd write it down here.</p>
<p>If you're coming to this topic for the first time, you may also want to check out <a href="http://equilibrator.weizmann.ac.il/static/classic_rxns/about.html">eQuilibrator's documentation</a> or <span class="citation" data-cites="noorConsistentEstimationGibbs2013">Noor et al. (2013)</span>, which are both very informative and readable guides to the scientific background. I've aimed to add some more detail to give an idea of where eQuilibrator's training data comes from and how it is transformed to take into account experimental conditions.</p>
<h1 id="background">Background</h1>
<p>The formation energy of a compound is the amount of energy that is stored or released by the chemical reaction that creates it out of its constituent elements. For example, according to <a href="https://en.wikipedia.org/wiki/Standard_Gibbs_free_energy_of_formation">Wikipedia</a>, liquid water has a formation energy of -237.14 kilojoules per mole. This means that creating 1 mole of liquid water out of gaseous hydrogen and oxygen stores 237.14 kilojoules of energy from the surrounding environment.</p>
<p>I'm interested in formation energies because I want to model the rates of metabolic reactions, which depend (among other things) on the thermodynamic properties of the metabolites that they produce and consume. For example, the compound ATP has a very low formation energy. Metabolism takes advantage of this by using ATP to store energy and to drive reactions that would otherwise be thermodynamically infeasible. Knowing the exact formation energy of a metabolite can help us to find out if a genetic intervention like knocking out a reaction or over-expressing an enzyme would help or hinder an organism's metabolism.</p>
<p>Unfortunately it's not always straightforward to measure a compound's formation energy. Metabolic networks involve lots of compounds, and not all of them have been measured accurately. As a result, there is a lot to be gained by taking advantage of scientific knowledge and statistical machinery, so as to make the best possible use of the available information. Over the last decade or so, as metabolic modelling has become more feasible and popular, there has been a corresponding effort to develop improved methods for estimating formation energies.</p>
<p>One of the most effective and, thanks to eQuilibrator well known, modelling methods is called component contribution. This method was introduced in <span class="citation" data-cites="noorConsistentEstimationGibbs2013">Noor et al. (2013)</span>, and is implemented in a collection of great publicly available <a href="https://gitlab.com/equilibrator/component-contribution/">python libraries</a>.</p>
<p>In what follows I'll try to explain where the training data for component contribution comes from and how it is pre-processed to take into account experimental conditions. I've written some original code to go with the text - it can be found <a href="https://github.com/teddygroves/teddygroves.github.io/tree/master/src/formation_energy">here</a>. To run it yourself you'll need a python 3 environment with the following packages installed:</p>
<ul>
<li><a href="https://gitlab.com/equilibrator/equilibrator-cache">equilibrator-cache</a></li>
<li><a href="https://gitlab.com/equilibrator/component-contribution">component-contribution</a></li>
<li><a href="https://pandas.pydata.org/">pandas</a></li>
<li><a href="https://numpy.org/">numpy</a></li>
<li><a href="https://www.scipy.org/">scipy</a></li>
</ul>
<h1 id="where-does-equilibrators-training-data-come-from">Where does eQuilibrator's training data come from?</h1>
<p>Equilibrator's training data consists of the following kinds of measurements:</p>
<ul>
<li>direct measurements of the energy change due to formation reactions</li>
<li>measurements of the reduction potential change due to redox reactions</li>
<li>measurements of equilibrium constants (i.e. the ratio of substrate to product concentration at thermal equilibrium) of non-formation reactions</li>
</ul>
<p>In addition eQuilibrator requires some supporting information:</p>
<ul>
<li>the stoichiometry of each measured reaction (i.e. the substrates and products and their relative proportions)</li>
<li>each compound's decomposition into microspecies</li>
<li>each microspecies's acid dissociation constants</li>
<li>each compound's decomposition into chemical groups</li>
<li>definitions of the chemical groups</li>
</ul>
<p>This python script fetches the measurements and some supporting information and saves them to csv files:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">from</span> equilibrator_cache <span class="im">import</span> create_compound_cache_from_quilt</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> component_contribution</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> quilt</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a>QUILT_PACKAGE_VERSION <span class="op">=</span> <span class="st">&#39;0.2.9&#39;</span></span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="kw">def</span> fetch_data(quilt_pkg):</span>
<span id="cb1-10"><a href="#cb1-10"></a>    ccache <span class="op">=</span> create_compound_cache_from_quilt(version<span class="op">=</span>QUILT_PACKAGE_VERSION)</span>
<span id="cb1-11"><a href="#cb1-11"></a>    con <span class="op">=</span> ccache.engine</span>
<span id="cb1-12"><a href="#cb1-12"></a>    <span class="cf">return</span> {</span>
<span id="cb1-13"><a href="#cb1-13"></a>        <span class="st">&#39;compounds&#39;</span>: pd.read_sql_table(<span class="st">&#39;compounds&#39;</span>, con<span class="op">=</span>con),</span>
<span id="cb1-14"><a href="#cb1-14"></a>        <span class="st">&#39;compound_identifiers&#39;</span>: pd.read_sql_table(<span class="st">&#39;compound_identifiers&#39;</span>, con<span class="op">=</span>con),</span>
<span id="cb1-15"><a href="#cb1-15"></a>        <span class="st">&#39;compound_microspecies&#39;</span>: pd.read_sql_table(<span class="st">&#39;compound_microspecies&#39;</span>, con<span class="op">=</span>con),</span>
<span id="cb1-16"><a href="#cb1-16"></a>        <span class="st">&#39;registries&#39;</span>: pd.read_sql_table(<span class="st">&#39;registries&#39;</span>, con<span class="op">=</span>con),</span>
<span id="cb1-17"><a href="#cb1-17"></a>        <span class="st">&#39;formation_measurements&#39;</span>: quilt_pkg.train.formation_energies_transformed(),</span>
<span id="cb1-18"><a href="#cb1-18"></a>        <span class="st">&#39;redox_measurements&#39;</span>: quilt_pkg.train.redox(),</span>
<span id="cb1-19"><a href="#cb1-19"></a>        <span class="st">&#39;tecrdb_measurements&#39;</span>: quilt_pkg.train.TECRDB(),</span>
<span id="cb1-20"><a href="#cb1-20"></a>    }</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>:</span>
<span id="cb1-24"><a href="#cb1-24"></a>    <span class="cf">try</span>:</span>
<span id="cb1-25"><a href="#cb1-25"></a>        quilt_pkg <span class="op">=</span> quilt.load(<span class="st">&#39;equilibrator/component_contribution&#39;</span>)</span>
<span id="cb1-26"><a href="#cb1-26"></a>    <span class="cf">except</span>:</span>
<span id="cb1-27"><a href="#cb1-27"></a>        quilt.install(</span>
<span id="cb1-28"><a href="#cb1-28"></a>            package<span class="op">=</span>component_contribution.DEFAULT_QUILT_PKG,</span>
<span id="cb1-29"><a href="#cb1-29"></a>            version<span class="op">=</span>QUILT_PACKAGE_VERSION,</span>
<span id="cb1-30"><a href="#cb1-30"></a>            force<span class="op">=</span><span class="va">True</span></span>
<span id="cb1-31"><a href="#cb1-31"></a>        )</span>
<span id="cb1-32"><a href="#cb1-32"></a>        quilt_pkg <span class="op">=</span> quilt.load(<span class="st">&#39;equilibrator/component_contribution&#39;</span>)</span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a>    dfs <span class="op">=</span> fetch_data(quilt_pkg)</span>
<span id="cb1-35"><a href="#cb1-35"></a></span>
<span id="cb1-36"><a href="#cb1-36"></a>    <span class="cf">for</span> df_name, df <span class="kw">in</span> dfs.items():</span>
<span id="cb1-37"><a href="#cb1-37"></a>        df.to_csv(<span class="ss">f&#39;data/</span><span class="sc">{</span>df_name<span class="sc">}</span><span class="ss">.csv&#39;</span>)</span></code></pre></div>
<p>Next we'll explore the different measurements in more detail.</p>
<h2 id="the-tecrdb-measurements">The tecrdb measurements</h2>
<p>The measurements in <code>tecrdb_measurements.csv</code> originally come from <a href="https://randr.nist.gov/enzyme/">this website</a>. The researchers who compiled it scanned lots of papers like this</p>
<p><img src="../img/citrate_synthase_measurements_paper.png" /></p>
<p>and put them in machine-readable form like this</p>
<p><img src="../img/citrate_synthase_tecrdb.png" /></p>
<p>The measurements in the TECRDB record a quantity called the equilibrium constant, or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">K&#39;</annotation></semantics></math>, which is the (experimental condition specific) ratio of substrates to products when the measured reaction is at thermal equilibrium. This quantity is related to the standard gibbs free energy of the reaction, which in turn is related to the formation energies of the compounds involved in the reaction.</p>
<p>Here is a graph showing the distribution of the raw <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">K&#39;</annotation></semantics></math> measurements for different reactions, arraged according to each reaction's mean measured value. Each measurement's colour represents the pH at which it was obtained.</p>
<p><img src="../img/tecrdb_kprime.png" /></p>
<p>Looking at the colours, it is clear that, for many reactions, the darker, bluer spots are on the left and the lighter, yellower spots are on the right. For these reactions, the measured <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">K&#39;</annotation></semantics></math> values were higher when the experiment was done at a higher pH. This illustrates the need to take into account experimental conditions - we will later look at how equilibrator does this.</p>
<p>The relationship, at temperature <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>, between the condition-specific equilibrium constant of a reaction <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">K&#39;</annotation></semantics></math> and the condition-sepcific gibbs free energy change <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G&#39;^{o}</annotation></semantics></math> is described by this equation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup><mo>=</mo><mo>−</mo><mi>R</mi><mi>T</mi><mo>ln</mo><mo stretchy="false" form="prefix">(</mo><mi>K</mi><mi>′</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
\Delta_r G&#39;^{o} = -RT\ln(K&#39;)
</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math> is a physical constant (the universal gas constant).</p>
<p>Applying this transformation produces the following standard gibbs free energy measurements:</p>
<p><img src="../img/tecrdb_dgprime.png" /></p>
<h2 id="formation-energy-measurements">Formation energy measurements</h2>
<p>The next source of relevant data are direct measurements of compound formation energies, taken from <span class="citation" data-cites="albertyThermodynamicsBiochemicalReactions2003">Alberty (2003)</span> and some other sources (see the column 'reference' in <code>formation_measurements.csv</code> for details). The measurements are of the are all recorded as having been taken at the same pH and temperature.</p>
<p>Here is a plot of these formation energy measurements:</p>
<p><img src="../img/formation_dgprime.png" /></p>
<p>The range of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_f G&#39;^o</annotation></semantics></math> values shown here is much greater than that of the TECRDB <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G&#39;^o</annotation></semantics></math> values plotted above. This is because of a technical limitation that equilibrium constants can only be measured when <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G&#39;^o</annotation></semantics></math> is close to zero.</p>
<h2 id="redox-reaction-measurements">Redox reaction measurements</h2>
<p>The table <code>redox_measurements.csv</code> records changes in reduction potential due to redox reactions, where a compound gains an electron. For example, <span class="citation" data-cites="loach2010oxidation">Loach (2010)</span> records NAD reduction, where the compound NAD(+) turns into NADH by gaining an electron, as changing the reduction potential by -0.32 Volts per mole.</p>
<p>The reduction potential change <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">E&#39;</annotation></semantics></math> of a redox reaction is related to its condition-specific gibbs free energy change <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G&#39;^{o}</annotation></semantics></math> by the following equation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup><mo>=</mo><mo>−</mo><mi>F</mi><mo>*</mo><mi>E</mi><mi>′</mi><mo>*</mo><msub><mi>Δ</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">
\Delta_r G&#39;^{o} = -F * E&#39; * \Delta_e
</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math> is the Faraday constant and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Δ</mi><mi>e</mi></msub><annotation encoding="application/x-tex">\Delta_e</annotation></semantics></math> is the total charge transferred by the reaction, taking into account both movements of electrons and hydrogen ions.</p>
<p>Here is a plot of the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G&#39;^{o}</annotation></semantics></math> values of the measured redox reactions.</p>
<p><img src="../img/redox_dgprime.png" /></p>
<h1 id="how-does-equilibrator-account-for-experimental-conditions">How does eQuilibrator account for experimental conditions?</h1>
<p>The component contribution method takes experimental conditions into account by transforming the measured condition-specific gibbs free energy changes to standard condition gibbs free energy changes using the method described in <span class="citation" data-cites="albertyThermodynamicsBiochemicalReactions2003">Alberty (2003)</span>. The transformed standard-condition values are then used as inputs to a statistical model.</p>
<p>This section outlines this pre-processing strategy, describes how eQuilibrator implements it and illustrates the results of transfomation on the TECRDB measurements.</p>
<h2 id="the-theory">The theory</h2>
<p>A reaction's thermodynamic behaviour in different conditions depends relatively straightforwardly on the thermodynamic properites of the compounds that it consumes and produces. The relationship between the condition-specific gibbs free energy change of a reaction <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G&#39;^{o}</annotation></semantics></math> and the condition-specific formation energies <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub><msub><mi>Δ</mi><mi>f</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">s_i \Delta_f G&#39;^{o}</annotation></semantics></math> and stoichiometric coefficients <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math> of its reactants is as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mspace width="0.222em"></mspace><mi>i</mi><mi>s</mi><mspace width="0.222em"></mspace><mi>a</mi><mspace width="0.222em"></mspace><mi>r</mi><mi>e</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow></munder><msub><mi>s</mi><mi>i</mi></msub><msub><mi>Δ</mi><mi>f</mi></msub><mi>G</mi><msubsup><mi>′</mi><mi>i</mi><mi>o</mi></msubsup></mrow><annotation encoding="application/x-tex">
\Delta_r G&#39;^{o} = \sum_{i\ is\ a\ reactant} s_i \Delta_f G&#39;_i^{o}
</annotation></semantics></math></p>
<p>Unfortunately the behaviour of compounds in different conditions is a bit more complicated. When dissolved in water, most biologically interesting compounds exist in several different forms called 'pseudoisomers' or 'microspecies', each with a different configuration of bindings to metal and hydrogen ions (the latter sometimes referred to as a protonation statte). The different microspecies' thermodynamic behaviour and relative proportions respond differently to experimental conditions, so they need to be considered individually in order to capture the behaviour of the whole compound.</p>
<p>The relationship between a compound's condition-specific formation energy and those of its microspecies is as follows:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup><mo>=</mo><mo>−</mo><mi>R</mi><mi>T</mi><mo>ln</mo><munder><mo>∑</mo><mrow><mi>i</mi><mspace width="0.222em"></mspace><mi>i</mi><mi>s</mi><mspace width="0.222em"></mspace><mi>a</mi><mspace width="0.222em"></mspace><mi>m</mi><mi>i</mi><mi>c</mi><mi>r</mi><mi>o</mi><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>e</mi><mi>s</mi></mrow></munder><mo>exp</mo><mo stretchy="false" form="prefix">(</mo><mo>−</mo><mfrac><mrow><msub><mi>Δ</mi><mi>f</mi></msub><mi>G</mi><msubsup><mi>′</mi><mi>i</mi><mi>o</mi></msubsup></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
\Delta_f G&#39;^{o} = -RT \ln \sum_{i\ is\ a\ microspecies} \exp(-\frac{\Delta_f G&#39;_i^{o}}{RT})
</annotation></semantics></math></p>
<p>The condition-specific formation energy of a microspecies has the following relationship with the conditions (i.e. the temperature <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>, ionic strength <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>I</mi><annotation encoding="application/x-tex">I</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">pH</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>M</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">pMg</annotation></semantics></math>), the microspecies's standard-condition formation entropy <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><msup><mi>S</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_f S^o</annotation></semantics></math>, the properties of the microspecies (i.e. its charge <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>, its number of protons <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>H</mi></mrow><annotation encoding="application/x-tex">nH</annotation></semantics></math> and its number of magnesium ions <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mi>M</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">nMg</annotation></semantics></math>) and some temperature-specific quantities (the formation energy of magnesium <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mrow><mi>M</mi><mi>g</mi></mrow><mi>o</mi></msubsup><mo stretchy="false" form="prefix">(</mo><mi>T</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\Delta_f
G_{Mg}^{o}(T)</annotation></semantics></math> and the Debeye-Hükel number <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>):<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><msub><mi>Δ</mi><mi>f</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mtd><mtd columnalign="left"><mo>=</mo><msub><mi>Δ</mi><mi>f</mi></msub><msup><mi>G</mi><mi>o</mi></msup></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mo>−</mo><mspace width="0.222em"></mspace><mo stretchy="false" form="prefix">(</mo><mi>T</mi><mo>−</mo><mn>298.15</mn><mo stretchy="false" form="postfix">)</mo><mo>⋅</mo><msub><mi>Δ</mi><mi>f</mi></msub><msup><mi>S</mi><mi>o</mi></msup></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mo>+</mo><mspace width="0.222em"></mspace><mi>n</mi><mi>H</mi><mo>⋅</mo><mi>R</mi><mi>T</mi><mo>⋅</mo><mo>ln</mo><mo stretchy="false" form="prefix">(</mo><mn>10</mn><mo stretchy="false" form="postfix">)</mo><mo>⋅</mo><mi>p</mi><mi>H</mi></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mo>−</mo><mspace width="0.222em"></mspace><mi>n</mi><mi>M</mi><mo>⋅</mo><mo stretchy="false" form="prefix">(</mo><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mrow><mi>M</mi><mi>g</mi></mrow><mi>o</mi></msubsup><mo stretchy="false" form="prefix">(</mo><mi>T</mi><mo stretchy="false" form="postfix">)</mo><mo>−</mo><mi>R</mi><mi>T</mi><mo>⋅</mo><mo>ln</mo><mo stretchy="false" form="prefix">(</mo><mn>10</mn><mo stretchy="false" form="postfix">)</mo><mo>⋅</mo><mi>p</mi><mi>M</mi><mi>g</mi><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mo>−</mo><mspace width="0.222em"></mspace><mi>R</mi><mi>T</mi><mo>⋅</mo><mi>α</mi><mo>⋅</mo><mo stretchy="false" form="prefix">(</mo><msup><mi>z</mi><mn>2</mn></msup><mo>−</mo><mi>n</mi><mi>H</mi><mo stretchy="false" form="postfix">)</mo><mo>⋅</mo><mo stretchy="false" form="prefix">(</mo><mfrac><msqrt><mi>I</mi></msqrt><mrow><mn>1</mn><mo>+</mo><msqrt><mi>I</mi></msqrt></mrow></mfrac><mo>−</mo><mn>0.3</mn><mo>⋅</mo><mi>I</mi><mo stretchy="false" form="postfix">)</mo></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align*}
\Delta_f G&#39;^{o} &amp;= \Delta_f G^{o} \\
 &amp;−\ (T − 298.15)\cdot \Delta_f S^o \\
 &amp;+\ nH\cdot RT\cdot \ln(10)\cdot pH \\
 &amp;-\ nM\cdot (\Delta_f G_{Mg}^{o}(T) - RT \cdot \ln(10)\cdot pMg) \\
 &amp;-\ RT\cdot\alpha\cdot(z^2 - nH)\cdot(\frac{\sqrt I}{1+\sqrt I} - 0.3 \cdot I)
\end{align*}
</annotation></semantics></math></p>
<p>With these equations it is possible to work out the condition-specific gibbs free energy change of a reaction given the standard-condition formation energies of all of the microspecies of the reactants, plus supporting information like the conditions.</p>
<p>Most microspecies' standard-condition formation energies are difficult to measure directly. However, it is possible to measure some related quantities called acid and magnesium dissociation constants. The dissociation constant for a binding reaction is the equilibrium ratio between the concentration of substrates to products, i.e. the unbound compound and ligand vs the bound compound. Negative log-scale acid dissociation constants are called <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>K</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">PK_a</annotation></semantics></math> and negative log-scale magnesium dissociation constants are called <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>K</mi><mrow><mi>M</mi><mi>g</mi></mrow></msub></mrow><annotation encoding="application/x-tex">PK_{Mg}</annotation></semantics></math>. In a solution where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>H</mi><mo>=</mo><mi>P</mi><msub><mi>K</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">pH = PK_a</annotation></semantics></math> or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>M</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">pMg</annotation></semantics></math> = PK<sub>Mg</sub>, the ratio of bound to unbound compound is 1.</p>
<p>Dissociation constants determine the gibbs free energy changes of binding reactions, and so can be used to infer differences in formation energy between microspecies of the same compound. Specifically, if a microspecies with minimum hydrogen ions has formation energy <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mn>0</mn><mi>o</mi></msubsup></mrow><annotation encoding="application/x-tex">\Delta_f G^o_0</annotation></semantics></math>, then a microspecies of the same compound with the same number of magnesium ions and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> more hydrogen ions has formation energy</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mi>n</mi><mi>o</mi></msubsup><mo>=</mo><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mn>0</mn><mi>o</mi></msubsup><mo>−</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover><mi>R</mi><mi>T</mi><mo>⋅</mo><msub><mo>log</mo><mn>10</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>P</mi><msub><mi>K</mi><mrow><mi>a</mi><mi>i</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
\Delta_f G^o_n = \Delta_f G^o_0 - \sum_{i=0}^n RT\cdot\log_{10}(PK_{ai})
</annotation></semantics></math></p>
<p>Similarly for magnesium ions, if a microspecies with no magnesium ions has formation energy <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mn>0</mn><mi>o</mi></msubsup></mrow><annotation encoding="application/x-tex">\Delta_f G^o_0</annotation></semantics></math>, then a microspecies of the same compound with the same number of hydrogen ions and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> more magnesium ions has formation energy</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mi>n</mi><mi>o</mi></msubsup><mo>=</mo><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mn>0</mn><mi>o</mi></msubsup><mo>+</mo><mi>n</mi><mo>⋅</mo><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mrow><mi>M</mi><mi>g</mi></mrow><mi>o</mi></msubsup><mo>−</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover><mi>R</mi><mi>T</mi><mo>⋅</mo><msub><mo>log</mo><mn>10</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>P</mi><msub><mi>K</mi><mrow><mi>M</mi><mi>g</mi><mi>i</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
\Delta_f G^o_n = \Delta_f G^o_0 + n\cdot\Delta_f G^o_{Mg}  - \sum_{i=0}^nRT\cdot\log_{10}(PK_{Mgi})
</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mrow><mi>M</mi><mi>g</mi></mrow><mi>o</mi></msubsup></mrow><annotation encoding="application/x-tex">\Delta_f G^o_{Mg}</annotation></semantics></math> is the standard condition formation energy of magnesium. This extra term appears because magnesium ions are bonded pairs of magnesium atoms and some energy is required to form the bond, whereas hydrogen ions have zero formation energy.</p>
<p>This theoretical machinery makes it possible in theory, given enough information, to estimate a reaction's condition-specific gibbs free energy change given the standard-condition number, and vice versa. The next section looks at how equilibrator does this conversion in practice.</p>
<h2 id="the-procedure">The procedure</h2>
<p>Equilibrator's strategy for taking into account experimental conditions is to use the theoretical relationships described above to transform all the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G&#39;^o</annotation></semantics></math> measurements to the values they would have had in standard conditions, and then fit a regression model to the transformed measurements.</p>
<p>To find the number to subtract from a reaction's <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><mi>G</mi><msup><mi>′</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G&#39;^o</annotation></semantics></math> measurement in order to transform it to standard conditions, equilibrator starts by considering all the microspecies of all the reactants.</p>
<p>Each microspecies has a starting change in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><msup><mi>G</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G^o</annotation></semantics></math> which is the sum of its dissociation constants. Equilibrator expresses all the changes in units of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">RT</annotation></semantics></math>, so the starting change for microspecies <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math> is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><msub><mi>t</mi><mi>j</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>m</mi></munderover><mo>⋅</mo><msub><mo>log</mo><mn>10</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>P</mi><msub><mi>K</mi><mrow><mi>a</mi><mi>i</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo><mo>+</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>n</mi></munderover><mo>⋅</mo><msub><mo>log</mo><mn>10</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>P</mi><msub><mi>K</mi><mrow><mi>M</mi><mi>g</mi><mi>i</mi></mrow></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
start_j = \sum_{i=0}^m \cdot\log_{10}(PK_{ai}) + \sum_{i=0}^n\cdot\log_{10}(PK_{Mgi})
</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math> is the microspecies's number of hydrogen ions above the minimum and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math> is its number of magnesium ions. This number is zero for the least protonated and magnesium-bonded microspecies of each compound.</p>
<p>Next, in order to take into account the conditions, the starting change of each microspecies is modified using the Legendre transform for number of protons, number of magnesiums and Debeye-Hükel factor, i.e. by adding</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right"><mfrac><mrow><mi>d</mi><mi>d</mi><msub><mi>g</mi><mi>j</mi></msub></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac></mtd><mtd columnalign="left"><mo>=</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><msub><mi>t</mi><mi>j</mi></msub></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mo>+</mo><mi>n</mi><mi>H</mi><mo>⋅</mo><msub><mo>log</mo><mn>10</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>p</mi><mi>H</mi><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mo>+</mo><mi>n</mi><mi>M</mi><mi>g</mi><mo>⋅</mo><mo stretchy="false" form="prefix">(</mo><msub><mo>log</mo><mn>10</mn></msub><mo stretchy="false" form="prefix">(</mo><mi>p</mi><mi>M</mi><mi>g</mi><mo stretchy="false" form="postfix">)</mo><mo>−</mo><mfrac><mrow><msub><mi>Δ</mi><mi>f</mi></msub><msubsup><mi>G</mi><mrow><mi>M</mi><mi>g</mi></mrow><mi>o</mi></msubsup></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac><mo stretchy="false" form="postfix">)</mo></mtd></mtr><mtr><mtd columnalign="right"></mtd><mtd columnalign="left"><mo>+</mo><mo stretchy="false" form="prefix">(</mo><mi>n</mi><mi>H</mi><mo>+</mo><mn>4</mn><mo>⋅</mo><mi>n</mi><mi>M</mi><mi>g</mi><mo>−</mo><msup><mi>z</mi><mn>2</mn></msup><mo stretchy="false" form="postfix">)</mo><mo>*</mo><mi>α</mi><mo stretchy="false" form="prefix">(</mo><mi>T</mi><mo stretchy="false" form="postfix">)</mo><mo>*</mo><mfrac><mrow><msqrt><mi>(</mi></msqrt><mi>I</mi><mo stretchy="false" form="postfix">)</mo></mrow><mrow><mn>1</mn><mo>+</mo><mn>1.6</mn><mo>*</mo><mi>s</mi><mi>q</mi><mi>r</mi><mi>t</mi><mo stretchy="false" form="prefix">(</mo><mi>I</mi><mo stretchy="false" form="postfix">)</mo></mrow></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{align*}
\frac{ddg_j}{RT} &amp;= start_j \\
&amp;+ nH \cdot\log_{10}(pH) \\
&amp;+ nMg \cdot(\log_{10}(pMg)- \frac{\Delta_f G^o_{Mg}}{RT}) \\
&amp;+ (nH + 4\cdot nMg - z^2) * \alpha(T) * \frac{\sqrt(I)}{1 + 1.6 * sqrt(I)}
\end{align*}
</annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo stretchy="false" form="prefix">(</mo><mi>T</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\alpha(T)</annotation></semantics></math> is the temperature-dependent Debeye-Hükel number. Note that, unlike in the equation above, equilibrator makes no adjustment for temperature and formation entropy.</p>
<p>Next each microspecies's condition-specific, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">RT</annotation></semantics></math>-relative <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><msup><mi>G</mi><mi>o</mi></msup></mrow><annotation encoding="application/x-tex">\Delta_r G^o</annotation></semantics></math> changes are aggregated to the compound level.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>d</mi><msub><mi>g</mi><mi>c</mi></msub></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac><mo>=</mo><mo>−</mo><mo>ln</mo><munder><mo>∑</mo><mrow><mi>i</mi><mspace width="0.222em"></mspace><mi>i</mi><mi>s</mi><mspace width="0.222em"></mspace><mi>a</mi><mspace width="0.222em"></mspace><mi>m</mi><mi>i</mi><mi>c</mi><mi>r</mi><mi>o</mi><mi>s</mi><mi>p</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>e</mi><mi>s</mi><mspace width="0.222em"></mspace><mi>o</mi><mi>f</mi><mspace width="0.222em"></mspace><mi>c</mi></mrow></munder><mo>−</mo><mo>exp</mo><mo stretchy="false" form="prefix">(</mo><mfrac><mrow><mi>d</mi><mi>d</mi><msub><mi>g</mi><mi>i</mi></msub></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">
\frac{ddg_c}{RT} = -\ln\sum_{i\ is\ a\ microspecies\ of\ c}-\exp(\frac{ddg_i}{RT})
</annotation></semantics></math></p>
<p>Finally, compound-level <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mi>d</mi><mi>d</mi><mi>g</mi></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac><annotation encoding="application/x-tex">\frac{ddg}{RT}</annotation></semantics></math> numbers are aggregated to the reaction level:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>d</mi><msub><mi>g</mi><mi>r</mi></msub></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mspace width="0.222em"></mspace><mi>i</mi><mi>s</mi><mspace width="0.222em"></mspace><mi>a</mi><mspace width="0.222em"></mspace><mi>r</mi><mi>e</mi><mi>a</mi><mi>c</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>t</mi><mspace width="0.222em"></mspace><mi>o</mi><mi>f</mi><mspace width="0.222em"></mspace><mi>r</mi></mrow></munder><msub><mi>s</mi><mi>i</mi></msub><mo>⋅</mo><mfrac><mrow><mi>d</mi><mi>d</mi><msub><mi>g</mi><mi>i</mi></msub></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\frac{ddg_r}{RT} = \sum_{i\ is\ a\ reactant\ of\ r} s_i\cdot\frac{ddg_i}{RT}
</annotation></semantics></math></p>
<p>and the transformed measurement is found as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><msup><mi>G</mi><mi>o</mi></msup><mo>=</mo><msub><mi>Δ</mi><mi>r</mi></msub><msup><mi>G</mi><mi>o</mi></msup><mi>′</mi><mo>−</mo><mfrac><mrow><mi>d</mi><mi>d</mi><msub><mi>g</mi><mi>r</mi></msub></mrow><mrow><mi>R</mi><mi>T</mi></mrow></mfrac><mo>⋅</mo><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">
\Delta_r G^{o} = \Delta_r G^{o}&#39; - \frac{ddg_r}{RT} \cdot RT
</annotation></semantics></math></p>
<p>The code that is spread across two equilibrator packages: <a href="https://gitlab.com/equilibrator/equilibrator-assets">equilibrator-assets</a> and <a href="https://gitlab.com/equilibrator/equilibrator-cache">equilibrator-cache</a>. The calculation of standard condition <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>g</mi><mi>/</mi><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">ddg/RT</annotation></semantics></math> values for each microspecies, based on acid dissociation constants, is done <a href="https://gitlab.com/equilibrator/equilibrator-assets/-/blob/master/src/equilibrator_assets/chemaxon.py#L483">here</a>. The code for calculating the legendre transform for a microspecies at a condition is <a href="https://gitlab.com/equilibrator/equilibrator-cache/blob/develop/src/equilibrator_cache/thermodynamic_constants.py">here</a>. Condition-specific <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>g</mi><mi>/</mi><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">ddg/RT</annotation></semantics></math> for microspecies are calculated by a method that belongs to the <a href="https://gitlab.com/equilibrator/equilibrator-cache/-/blob/develop/src/equilibrator_cache/models/compound_microspecies.py">CompoundMicrospecies</a> object. Compound <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>g</mi><mi>/</mi><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">ddg/RT</annotation></semantics></math> values are calculated from microspecies in the <a href="https://gitlab.com/equilibrator/equilibrator-cache/-/blob/develop/src/equilibrator_cache/models/compound.py">Compound</a> object, and reaction <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>g</mi><mi>/</mi><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">ddg/RT</annotation></semantics></math> values in the <a href="https://gitlab.com/equilibrator/equilibrator-cache/-/blob/develop/src/equilibrator_cache/reaction.py">Reaction</a> object.</p>
<p>To make clear how these calculations work together, and to make sure I understood it myself, I made some python functions that give equivalent results to eQuilibrator's preprocessing, but can all be viewed in the same place. A script that uses the functions can be found <a href="https://github.com/teddygroves/teddygroves.github.io/blob/master/src/formation_energy/process_tecrdb.py">here</a> - for the TECRDB measurements the results seem to be the same.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="co">&quot;&quot;&quot;Functions for doing Legendre transforms&quot;&quot;&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="im">from</span> equilibrator_cache.models <span class="im">import</span> Compound, CompoundMicrospecies</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="im">from</span> equilibrator_cache.reaction <span class="im">import</span> Reaction</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="im">from</span> scipy.special <span class="im">import</span> logsumexp</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a>R <span class="op">=</span> <span class="fl">8.31e-3</span>                                       <span class="co"># kJ / mol / K</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>standard_dg_formation_mg <span class="op">=</span> <span class="fl">-455.3</span>                 <span class="co"># kJ/mol (Mg2+ formation energy)</span></span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="kw">def</span> dh(ionic_strength: <span class="bu">float</span>, temperature: <span class="bu">float</span>) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb2-13"><a href="#cb2-13"></a>    <span class="co">&quot;&quot;&quot;Debeye-Hueckel factor for finding an ionic strength/temperature effect.&quot;&quot;&quot;</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>    _a1 <span class="op">=</span> <span class="fl">1.108</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>    _a2 <span class="op">=</span> <span class="fl">1.546e-3</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>    _a3 <span class="op">=</span> <span class="fl">5.959e-6</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>    B <span class="op">=</span> <span class="fl">1.6</span></span>
<span id="cb2-18"><a href="#cb2-18"></a>    alpha <span class="op">=</span> _a1 <span class="op">-</span> _a2 <span class="op">*</span> temperature <span class="op">+</span> _a3 <span class="op">*</span> temperature <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="cf">return</span> <span class="fl">0.0</span> <span class="cf">if</span> ionic_strength <span class="op">&lt;=</span> <span class="fl">0.0</span> <span class="cf">else</span> (</span>
<span id="cb2-20"><a href="#cb2-20"></a>        alpha <span class="op">*</span> ionic_strength <span class="op">**</span> <span class="fl">0.5</span> <span class="op">/</span> (<span class="fl">1.0</span> <span class="op">+</span> B <span class="op">*</span> ionic_strength <span class="op">**</span> <span class="fl">0.5</span>)</span>
<span id="cb2-21"><a href="#cb2-21"></a>    )</span>
<span id="cb2-22"><a href="#cb2-22"></a></span>
<span id="cb2-23"><a href="#cb2-23"></a></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="kw">def</span> legendre_transform(</span>
<span id="cb2-25"><a href="#cb2-25"></a>    p_h: <span class="bu">float</span>,</span>
<span id="cb2-26"><a href="#cb2-26"></a>    ionic_strength: <span class="bu">float</span>,</span>
<span id="cb2-27"><a href="#cb2-27"></a>    temperature: <span class="bu">float</span>,</span>
<span id="cb2-28"><a href="#cb2-28"></a>    p_mg: <span class="bu">float</span>,</span>
<span id="cb2-29"><a href="#cb2-29"></a>    num_protons: <span class="bu">float</span>,</span>
<span id="cb2-30"><a href="#cb2-30"></a>    charge: <span class="bu">float</span>,</span>
<span id="cb2-31"><a href="#cb2-31"></a>    num_magnesiums: <span class="bu">float</span>,</span>
<span id="cb2-32"><a href="#cb2-32"></a>):</span>
<span id="cb2-33"><a href="#cb2-33"></a>    log10 <span class="op">=</span> np.log(<span class="dv">10</span>)</span>
<span id="cb2-34"><a href="#cb2-34"></a>    RT <span class="op">=</span> R <span class="op">*</span> temperature</span>
<span id="cb2-35"><a href="#cb2-35"></a>    ph_part <span class="op">=</span> num_protons <span class="op">*</span> log10 <span class="op">*</span> p_h</span>
<span id="cb2-36"><a href="#cb2-36"></a>    dh_part <span class="op">=</span> (num_protons <span class="op">-</span> charge <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> dh(ionic_strength, temperature)</span>
<span id="cb2-37"><a href="#cb2-37"></a>    mg_part <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> num_magnesiums <span class="op">&lt;=</span> <span class="dv">0</span> <span class="cf">else</span> num_magnesiums <span class="op">*</span> (</span>
<span id="cb2-38"><a href="#cb2-38"></a>        p_mg <span class="op">*</span> log10 <span class="op">-</span> standard_dg_formation_mg <span class="op">/</span> RT</span>
<span id="cb2-39"><a href="#cb2-39"></a>    )</span>
<span id="cb2-40"><a href="#cb2-40"></a>    <span class="cf">return</span> ph_part <span class="op">+</span> dh_part <span class="op">+</span> mg_part</span>
<span id="cb2-41"><a href="#cb2-41"></a></span>
<span id="cb2-42"><a href="#cb2-42"></a></span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="kw">def</span> get_ddg_over_rt_for_microspecies(</span>
<span id="cb2-44"><a href="#cb2-44"></a>    ms: CompoundMicrospecies,</span>
<span id="cb2-45"><a href="#cb2-45"></a>    p_h: <span class="bu">float</span>,</span>
<span id="cb2-46"><a href="#cb2-46"></a>    ionic_strength: <span class="bu">float</span>,</span>
<span id="cb2-47"><a href="#cb2-47"></a>    temperature: <span class="bu">float</span>,</span>
<span id="cb2-48"><a href="#cb2-48"></a>    p_mg: <span class="bu">float</span></span>
<span id="cb2-49"><a href="#cb2-49"></a>):</span>
<span id="cb2-50"><a href="#cb2-50"></a>    conditions <span class="op">=</span> p_h, ionic_strength, temperature, p_mg</span>
<span id="cb2-51"><a href="#cb2-51"></a>    ms_facts <span class="op">=</span> ms.number_protons, ms.charge, ms.number_magnesiums</span>
<span id="cb2-52"><a href="#cb2-52"></a>    <span class="cf">return</span> ms.ddg_over_rt <span class="op">+</span> legendre_transform(<span class="op">*</span>conditions, <span class="op">*</span>ms_facts)</span>
<span id="cb2-53"><a href="#cb2-53"></a></span>
<span id="cb2-54"><a href="#cb2-54"></a></span>
<span id="cb2-55"><a href="#cb2-55"></a><span class="kw">def</span> get_ddg_over_rt_for_compound(</span>
<span id="cb2-56"><a href="#cb2-56"></a>    cpd: Compound,</span>
<span id="cb2-57"><a href="#cb2-57"></a>    p_h: <span class="bu">float</span>,</span>
<span id="cb2-58"><a href="#cb2-58"></a>    ionic_strength: <span class="bu">float</span>,</span>
<span id="cb2-59"><a href="#cb2-59"></a>    temperature: <span class="bu">float</span>,</span>
<span id="cb2-60"><a href="#cb2-60"></a>    p_mg: <span class="bu">float</span></span>
<span id="cb2-61"><a href="#cb2-61"></a>):</span>
<span id="cb2-62"><a href="#cb2-62"></a>    conditions <span class="op">=</span> p_h, ionic_strength, temperature, p_mg</span>
<span id="cb2-63"><a href="#cb2-63"></a>    <span class="cf">return</span> <span class="op">-</span>logsumexp([</span>
<span id="cb2-64"><a href="#cb2-64"></a>        <span class="dv">-1</span> <span class="op">*</span> get_ddg_over_rt_for_microspecies(ms, <span class="op">*</span>conditions)</span>
<span id="cb2-65"><a href="#cb2-65"></a>        <span class="cf">for</span> ms <span class="kw">in</span> cpd.microspecies</span>
<span id="cb2-66"><a href="#cb2-66"></a>    ])</span>
<span id="cb2-67"><a href="#cb2-67"></a></span>
<span id="cb2-68"><a href="#cb2-68"></a></span>
<span id="cb2-69"><a href="#cb2-69"></a><span class="kw">def</span> get_ddg_over_rt_for_reaction(</span>
<span id="cb2-70"><a href="#cb2-70"></a>        rxn: Reaction,</span>
<span id="cb2-71"><a href="#cb2-71"></a>        p_h: <span class="bu">float</span>,</span>
<span id="cb2-72"><a href="#cb2-72"></a>        ionic_strength: <span class="bu">float</span>,</span>
<span id="cb2-73"><a href="#cb2-73"></a>        temperature: <span class="bu">float</span>,</span>
<span id="cb2-74"><a href="#cb2-74"></a>        p_mg: <span class="bu">float</span></span>
<span id="cb2-75"><a href="#cb2-75"></a>):</span>
<span id="cb2-76"><a href="#cb2-76"></a>    conditions <span class="op">=</span> p_h, ionic_strength, temperature, p_mg</span>
<span id="cb2-77"><a href="#cb2-77"></a>    <span class="cf">return</span> <span class="bu">sum</span>([</span>
<span id="cb2-78"><a href="#cb2-78"></a>        stoichiometric_coef <span class="op">*</span> get_ddg_over_rt_for_compound(cpd, <span class="op">*</span>conditions)</span>
<span id="cb2-79"><a href="#cb2-79"></a>        <span class="cf">for</span> cpd, stoichiometric_coef <span class="kw">in</span> rxn.items(protons<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-80"><a href="#cb2-80"></a>    ])</span></code></pre></div>
<h2 id="what-do-the-tecrdb-measurements-look-like-after-preprocessing">What do the TECRDB measurements look like after preprocessing?</h2>
<p>Here are the transformed, standard condition gibbs free energy changes for the TECRDB measurements:</p>
<p><img src="../img/tecrdb_standard_dg.png" /></p>
<p>The colors show the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>g</mi><mi>/</mi><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">ddg/RT</annotation></semantics></math> value for each reaction, i.e. essentially the difference between the untransformed and transformed values. It is clear from the graph that the adjustments due to Legendre transforms are substantial.</p>
<h2 id="discussion">Discussion</h2>
<p>Using inverse Legendre transforms to coerce the measurements to standard conditions before modelling is better than naively using the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Δ</mi><mi>r</mi></msub><msup><mi>G</mi><mi>o</mi></msup><mi>′</mi></mrow><annotation encoding="application/x-tex">\Delta_r G^{o}&#39;</annotation></semantics></math> values - see the supplementary appendix S1 of <span class="citation" data-cites="noorConsistentEstimationGibbs2013">Noor et al. (2013)</span> for a comparison of these two alternatives. However, this method introduces several issues. First, any uncertainty as to the dissociation constants used to infer each microspecies's standard condition <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mi>d</mi><mi>g</mi><mi>/</mi><mi>R</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">ddg/RT</annotation></semantics></math> value is ignored. Second, the experimental conditions - particularly pMg and ionic strength - are not always recorded accurately and are sometimes missing altogether. In order to maintain reasonable coverage, the component contribution method imputes default values where pMg (default value 14) or ionic strength (default value 0.25M) is missing.</p>
<p>These issues could be addressed by accounting for them when modelling the transformed data, for example by using a model that can assume different (hopefully worse) accuracies for measurements where a default ionic strength or pMg value was assumed. Alternatively, the dependency of measurements on experimental conditions could be included in a model using forward Legendre transforms rather than being addressed in pre-processing.</p>
<h1 id="references" class="unnumbered">References</h1>
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-albertyThermodynamicsBiochemicalReactions2003">
<p>Alberty, Robert A. 2003. <em>Thermodynamics of Biochemical Reactions</em>. Hoboken, N.J: Wiley-Interscience.</p>
</div>
<div id="ref-duTemperatureDependentEstimationGibbs">
<p>Du, Bin. n.d. “Temperature-Dependent Estimation of Gibbs Energies Using an Updated Group-Contribution Method,” 12.</p>
</div>
<div id="ref-loach2010oxidation">
<p>Loach, Paul A. 2010. “Oxidation-Reduction Potentials, Absorbance Bands and Molar Absorbance of Compounds Used in Biochemical Studies.” <em>Handbook of Biochemistry and Molecular Biology, 4th Ed. CRC Press, Boca Raton, FL</em>, 557–63.</p>
</div>
<div id="ref-noorConsistentEstimationGibbs2013">
<p>Noor, Elad, Hulda S. Haraldsdóttir, Ron Milo, and Ronan M. T. Fleming. 2013. “Consistent Estimation of Gibbs Energy Using Component Contributions.” Edited by Daniel A. Beard. <em>PLoS Computational Biology</em> 9 (7): e1003098. <a href="https://doi.org/10.1371/journal.pcbi.1003098">https://doi.org/10.1371/journal.pcbi.1003098</a>.</p>
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>see <span class="citation" data-cites="albertyThermodynamicsBiochemicalReactions2003">Alberty (2003)</span> section 4.5, 'thermodynamics of pseudoisomer groups at specified pH'<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>see <span class="citation" data-cites="duTemperatureDependentEstimationGibbs">Du (n.d.)</span> supplementary material, equation 8<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
</body>
</html>
